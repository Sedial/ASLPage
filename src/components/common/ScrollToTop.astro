---
interface Props {
  threshold?: number;
  smooth?: boolean;
  offset?: number;
  size?: 'sm' | 'md' | 'lg';
  position?: 'right' | 'left';
  class?: string;
}

const {
  threshold = 300,
  smooth = true,
  offset = 20,
  size = 'md',
  position = 'right',
  class: className = '',
} = Astro.props;

const sizeClasses = {
  sm: 'w-10 h-10 text-xs',
  md: 'w-12 h-12 text-sm',
  lg: 'w-14 h-14 text-base'
};

const positionClasses = {
  right: 'right-4 sm:right-6',
  left: 'left-4 sm:left-6'
};

const bottomOffset = `${offset}px`;
---

<button
  id="scroll-to-top"
  aria-label="Scroll to top"
  class={`fixed bottom-[${bottomOffset}] ${positionClasses[position]} ${sizeClasses[size]} rounded-full bg-primary-600 text-white shadow-xl flex items-center justify-center opacity-0 invisible transition-all duration-300 hover:bg-primary-500 focus:outline-none focus:ring-2 focus:ring-primary-400 transform hover:scale-105 z-50 border border-white/20 backdrop-blur-sm ${className}`}
>
  <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
    <path d="M18 15l-6-6-6 6"/>
  </svg>
</button>

<style>
  @keyframes pulse {
    0% { transform: scale(1); box-shadow: 0 10px 15px -3px rgba(158, 36, 32, 0.3); }
    50% { transform: scale(1.05); box-shadow: 0 15px 20px -3px rgba(158, 36, 32, 0.4); }
    100% { transform: scale(1); box-shadow: 0 10px 15px -3px rgba(158, 36, 32, 0.3); }
  }
  
  #scroll-to-top.visible {
    animation: pulse 3s infinite ease-in-out;
  }
  
  #scroll-to-top:hover {
    animation: none;
    box-shadow: 0 20px 25px -5px rgba(158, 36, 32, 0.5);
  }
</style>

<script define:vars={{ threshold, smooth, bottomOffset }}>
  const scrollToTopBtn = document.getElementById('scroll-to-top');
  
  const scrollFunction = () => {
    if (document.body.scrollTop > threshold || document.documentElement.scrollTop > threshold) {
      scrollToTopBtn.classList.remove('opacity-0', 'invisible');
      scrollToTopBtn.classList.add('opacity-100', 'visible');
    } else {
      scrollToTopBtn.classList.remove('opacity-100', 'visible');
      scrollToTopBtn.classList.add('opacity-0', 'invisible');
    }
  };
  
  const scrollToTop = () => {
    const currentPosition = document.documentElement.scrollTop || document.body.scrollTop;
    
    if (currentPosition > 0) {
      if (smooth) {
        window.scrollTo({
          top: 0,
          behavior: 'smooth'
        });
      } else {
        window.scrollTo(0, 0);
      }
    }
  };
  
  window.addEventListener('scroll', scrollFunction);
  scrollToTopBtn.addEventListener('click', scrollToTop);
  
  // Fix position on load
  scrollToTopBtn.style.bottom = bottomOffset;
</script>
