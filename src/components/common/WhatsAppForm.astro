---
interface Props {
  phoneNumber?: string;
  class?: string;
}

const {
  phoneNumber = '+573112057108',
  class: className = '',
} = Astro.props;
---

<!-- Modal de formulario -->
<div id="whatsapp-modal" class="fixed inset-0 bg-black/70 backdrop-blur-lg z-[60] hidden items-center justify-center p-3 sm:p-4">
  <div class="bg-white rounded-3xl shadow-2xl max-w-sm sm:max-w-lg w-full mx-auto transform transition-all duration-500 ease-out scale-95 opacity-0 max-h-[95vh] overflow-y-auto border border-gray-100" id="modal-content">
    <!-- Header -->
    <div class="bg-gradient-to-br from-primary-500 via-primary-600 to-primary-700 text-white p-6 sm:p-8 rounded-t-3xl relative overflow-hidden">
      <!-- Decorative background pattern -->
      <div class="absolute inset-0 opacity-10">
        <svg class="w-full h-full" viewBox="0 0 100 100" fill="none">
          <defs>
            <pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse">
              <path d="M 10 0 L 0 0 0 10" fill="none" stroke="currentColor" stroke-width="0.5"/>
            </pattern>
          </defs>
          <rect width="100" height="100" fill="url(#grid)"/>
        </svg>
      </div>
      
      <div class="flex items-center justify-between relative z-10">
        <div class="flex items-center gap-3 sm:gap-4">
          <div class="bg-white/20 backdrop-blur-sm rounded-2xl p-3 sm:p-4">
            <svg class="w-7 h-7 sm:w-9 sm:h-9" fill="currentColor" viewBox="0 0 24 24">
              <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.893 3.386"/>
            </svg>
          </div>
          <div>
            <h3 class="text-xl sm:text-2xl font-bold tracking-tight text-blue-100">Contactar por WhatsApp</h3>
            <p class="text-white/90 text-sm sm:text-base font-medium mt-1">ASL - Log√≠stica 3PL Colombia</p>
          </div>
        </div>
        <button id="close-modal" class="text-white/80 hover:text-white transition-all duration-200 p-2 hover:bg-white/10 rounded-xl">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
    </div>

    <!-- Formulario -->
    <form id="whatsapp-form" class="p-6 sm:p-8 space-y-5 sm:space-y-6">
      <div class="text-center mb-6">
        <div class="inline-flex items-center gap-2 bg-gradient-to-r from-primary-50 to-primary-100 px-4 py-2 rounded-full mb-3">
          <svg class="w-4 h-4 text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
          </svg>
          <span class="text-primary-700 text-sm font-medium">Informaci√≥n de contacto</span>
        </div>
        <p class="text-gray-600 text-sm leading-relaxed max-w-sm mx-auto">Complete sus datos para recibir una atenci√≥n personalizada y especializada</p>
      </div>

      <!-- Nombre -->
      <div class="space-y-2">
        <label for="name" class="flex items-center gap-2 text-sm font-semibold text-gray-800">
          <svg class="w-4 h-4 text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
          </svg>
          Nombre completo *
        </label>
        <div class="relative">
          <input 
            type="text" 
            id="name" 
            name="name" 
            required 
            class="w-full px-4 py-3.5 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all duration-300 text-sm text-black bg-gray-50/50 hover:bg-white hover:border-primary-300 placeholder-gray-400"
            placeholder="Ingrese su nombre completo"
          >
        </div>
      </div>

      <!-- Tel√©fono -->
      <div class="space-y-2">
        <label for="phone" class="flex items-center gap-2 text-sm font-semibold text-gray-800">
          <svg class="w-4 h-4 text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"></path>
          </svg>
          N√∫mero de tel√©fono *
        </label>
        <div class="relative">
          <input 
            type="tel" 
            id="phone" 
            name="phone" 
            required 
            class="w-full px-4 py-3.5 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all duration-300 text-sm text-black bg-gray-50/50 hover:bg-white hover:border-primary-300 placeholder-gray-400"
            placeholder="+57 300 123 4567"
          >
        </div>
      </div>

      <!-- Email -->
      <div class="space-y-2">
        <label for="email" class="flex items-center gap-2 text-sm font-semibold text-gray-800">
          <svg class="w-4 h-4 text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 4.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
          </svg>
          Correo electr√≥nico *
        </label>
        <div class="relative">
          <input 
            type="email" 
            id="email" 
            name="email" 
            required 
            class="w-full px-4 py-3.5 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all duration-300 text-sm text-black bg-gray-50/50 hover:bg-white hover:border-primary-300 placeholder-gray-400"
            placeholder="correo@empresa.com"
          >
        </div>
      </div>

      <!-- Empresa -->
      <div class="space-y-2">
        <label for="company" class="flex items-center gap-2 text-sm font-semibold text-gray-800">
          <svg class="w-4 h-4 text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
          </svg>
          Empresa *
        </label>
        <div class="relative">
          <input 
            type="text" 
            id="company" 
            name="company" 
            required 
            class="w-full px-4 py-3.5 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all duration-300 text-sm text-black bg-gray-50/50 hover:bg-white hover:border-primary-300 placeholder-gray-400"
            placeholder="Nombre de su empresa"
          >
        </div>
      </div>

      <!-- Mensaje adicional -->
      <div class="space-y-2">
        <label for="message" class="flex items-center gap-2 text-sm font-semibold text-gray-800">
          <svg class="w-4 h-4 text-primary-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
          </svg>
          Mensaje adicional
          <span class="text-gray-500 text-xs">(opcional)</span>
        </label>
        <div class="relative">
          <textarea 
            id="message" 
            name="message" 
            rows="4"
            class="w-full px-4 py-3.5 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all duration-300 resize-none text-sm text-black bg-gray-50/50 hover:bg-white hover:border-primary-300 placeholder-gray-400"
            placeholder="Cu√©ntanos sobre tu consulta o necesidad espec√≠fica en log√≠stica..."
          ></textarea>
        </div>
      </div>

      <!-- Botones -->
      <div class="flex flex-col sm:flex-row gap-3 sm:gap-4 pt-6 border-t border-gray-100">
        <button 
          type="button" 
          id="cancel-form" 
          class="w-full sm:flex-1 px-6 py-3.5 border-2 border-gray-200 text-gray-600 rounded-xl hover:bg-gray-50 hover:border-gray-300 transition-all duration-300 font-semibold text-sm order-2 sm:order-1 flex items-center justify-center gap-2 hover:shadow-md"
        >
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
          Cancelar
        </button>
        <button 
          type="submit" 
          class="w-full sm:flex-1 px-6 py-3.5 bg-gradient-to-r from-primary-500 via-primary-600 to-primary-700 text-white rounded-xl hover:from-primary-600 hover:via-primary-700 hover:to-primary-800 transition-all duration-300 font-semibold shadow-lg hover:shadow-xl transform hover:scale-[1.02] text-sm order-1 sm:order-2 flex items-center justify-center gap-2 relative overflow-hidden group"
        >
          <!-- Shimmer effect -->
          <div class="absolute inset-0 -skew-x-12 bg-gradient-to-r from-transparent via-white/20 to-transparent opacity-0 group-hover:opacity-100 group-hover:animate-pulse transition-opacity duration-500"></div>
          <svg class="w-5 h-5 relative z-10" fill="currentColor" viewBox="0 0 24 24">
            <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893A11.821 11.821 0 0020.893 3.386"/>
          </svg>
          <span class="relative z-10">Enviar por WhatsApp</span>
        </button>
      </div>
    </form>
  </div>
</div>

<style>
  /* Animaciones del modal */
  #whatsapp-modal {
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
  }
  
  #whatsapp-modal.show {
    display: flex !important;
    animation: modalFadeIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  }
  
  #whatsapp-modal.show #modal-content {
    transform: scale(1) translateY(0);
    opacity: 1;
    animation: modalSlideIn 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
  }
  
  @keyframes modalFadeIn {
    from {
      opacity: 0;
    }
    to {
      opacity: 1;
    }
  }
  
  @keyframes modalSlideIn {
    from {
      transform: scale(0.9) translateY(20px);
      opacity: 0;
    }
    to {
      transform: scale(1) translateY(0);
      opacity: 1;
    }
  }
  
  /* Estilos de validaci√≥n con colores de marca */
  .error {
    border-color: #CA241C !important;
    box-shadow: 0 0 0 4px rgba(202, 36, 28, 0.1) !important;
    background-color: rgba(202, 36, 28, 0.03) !important;
    animation: errorShake 0.5s ease-in-out;
  }
  
  @keyframes errorShake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-4px); }
    75% { transform: translateX(4px); }
  }
  
  .error-message {
    color: #CA241C;
    font-size: 0.75rem;
    margin-top: 0.5rem;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 0.25rem;
    animation: errorFadeIn 0.3s ease-out;
  }
  
  @keyframes errorFadeIn {
    from {
      opacity: 0;
      transform: translateY(-4px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  
  /* Mejoras responsivas */
  @media (max-width: 640px) {
    #whatsapp-modal {
      padding: 1rem;
    }
    
    #modal-content {
      max-height: 92vh;
      border-radius: 1.5rem;
    }
    
    /* Ajustar tama√±o de inputs en m√≥vil */
    input, textarea {
      font-size: 16px; /* Previene zoom en iOS */
    }
  }
  
  /* Estados de focus mejorados */
  input:focus, textarea:focus {
    outline: none;
    border-color: #CA241C;
    box-shadow: 0 0 0 4px rgba(202, 36, 28, 0.1);
    background-color: white;
    transform: translateY(-1px);
  }
  
  /* Efectos hover para inputs */
  input:hover:not(:focus), textarea:hover:not(:focus) {
    border-color: #CA241C;
    background-color: white;
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
  }
  
  /* Animaci√≥n suave para botones */
  button {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
  }
  
  /* Efecto ripple para botones */
  button:active {
    transform: scale(0.98);
  }
  
  /* Mejora visual para labels */
  label {
    color: #374151;
    font-weight: 600;
    transition: color 0.2s ease;
  }
  
  /* Animaci√≥n de carga para el bot√≥n submit */
  .loading {
    pointer-events: none;
    opacity: 0.8;
  }
  
  .loading::after {
    content: '';
    position: absolute;
    width: 16px;
    height: 16px;
    margin: auto;
    border: 2px solid transparent;
    border-top-color: #ffffff;
    border-radius: 50%;
    animation: spin 1s linear infinite;
  }
  
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  
  /* Mejoras de accesibilidad */
  @media (prefers-reduced-motion: reduce) {
    * {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }
  
  /* Scroll personalizado */
  #modal-content::-webkit-scrollbar {
    width: 6px;
  }
  
  #modal-content::-webkit-scrollbar-track {
    background: #f1f5f9;
    border-radius: 3px;
  }
  
  #modal-content::-webkit-scrollbar-thumb {
    background: #cbd5e1;
    border-radius: 3px;
  }
  
  #modal-content::-webkit-scrollbar-thumb:hover {
    background: #94a3b8;
  }
</style>

<script define:vars={{ phoneNumber }}>
  document.addEventListener('DOMContentLoaded', () => {
    const modal = document.getElementById('whatsapp-modal');
    const modalContent = document.getElementById('modal-content');
    const form = document.getElementById('whatsapp-form');
    const closeBtn = document.getElementById('close-modal');
    const cancelBtn = document.getElementById('cancel-form');
    
    // Funci√≥n para abrir el modal
    window.openWhatsAppModal = () => {
      modal.classList.add('show');
      document.body.style.overflow = 'hidden';
      
      // Animar entrada
      setTimeout(() => {
        modalContent.style.transform = 'scale(1)';
        modalContent.style.opacity = '1';
      }, 10);
    };
    
    // Funci√≥n para cerrar el modal
    const closeModal = () => {
      modalContent.style.transform = 'scale(0.95)';
      modalContent.style.opacity = '0';
      
      setTimeout(() => {
        modal.classList.remove('show');
        document.body.style.overflow = '';
        form.reset();
        clearErrors();
      }, 300);
    };
    
    // Event listeners para cerrar
    closeBtn.addEventListener('click', closeModal);
    cancelBtn.addEventListener('click', closeModal);
    
    // Cerrar al hacer click fuera del modal
    modal.addEventListener('click', (e) => {
      if (e.target === modal) {
        closeModal();
      }
    });
    
    // Cerrar con ESC
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && modal.classList.contains('show')) {
        closeModal();
      }
    });
    
    // Funci√≥n para limpiar errores
    const clearErrors = () => {
      const errorInputs = form.querySelectorAll('.error');
      const errorMessages = form.querySelectorAll('.error-message');
      
      errorInputs.forEach(input => input.classList.remove('error'));
      errorMessages.forEach(msg => msg.remove());
    };
    
    // Funci√≥n para mostrar error
    const showError = (input, message) => {
      input.classList.add('error');
      
      const errorDiv = document.createElement('div');
      errorDiv.className = 'error-message';
      
      // Agregar icono de error
      const errorIcon = document.createElement('svg');
      errorIcon.className = 'w-4 h-4 text-red-500 flex-shrink-0';
      errorIcon.setAttribute('fill', 'none');
      errorIcon.setAttribute('stroke', 'currentColor');
      errorIcon.setAttribute('viewBox', '0 0 24 24');
      errorIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>';
      
      const errorText = document.createElement('span');
      errorText.textContent = message;
      
      errorDiv.appendChild(errorIcon);
      errorDiv.appendChild(errorText);
      
      input.parentNode.appendChild(errorDiv);
      
      // Scroll suave al primer error
      if (form.querySelectorAll('.error').length === 1) {
        input.scrollIntoView({ behavior: 'smooth', block: 'center' });
      }
    };
    
    // Validaci√≥n del formulario
    const validateForm = (formData) => {
      clearErrors();
      let isValid = true;
      
      // Validar nombre
      if (!formData.name.trim()) {
        showError(form.name, 'El nombre es requerido');
        isValid = false;
      }
      
      // Validar tel√©fono
      if (!formData.phone.trim()) {
        showError(form.phone, 'El tel√©fono es requerido');
        isValid = false;
      }
      
      // Validar email
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!formData.email.trim()) {
        showError(form.email, 'El correo electr√≥nico es requerido');
        isValid = false;
      } else if (!emailRegex.test(formData.email)) {
        showError(form.email, 'Ingrese un correo electr√≥nico v√°lido');
        isValid = false;
      }
      
      // Validar empresa
      if (!formData.company.trim()) {
        showError(form.company, 'La empresa es requerida');
        isValid = false;
      }
      
      return isValid;
    };
    
    // Manejar env√≠o del formulario
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const submitBtn = form.querySelector('button[type="submit"]');
      const submitText = submitBtn.querySelector('span');
      const originalText = submitText.textContent;
      
      const formData = {
        name: form.name.value.trim(),
        phone: form.phone.value.trim(),
        email: form.email.value.trim(),
        company: form.company.value.trim(),
        message: form.message.value.trim()
      };
      
      if (!validateForm(formData)) {
        return;
      }
      
      // Mostrar estado de carga
      submitBtn.classList.add('loading');
      submitBtn.disabled = true;
      submitText.textContent = 'Preparando mensaje...';
      
      try {
        // Simular peque√±a pausa para mejor UX
        await new Promise(resolve => setTimeout(resolve, 800));
        
        // Crear mensaje personalizado
        let whatsappMessage = `¬°Hola! Soy ${formData.name} de ${formData.company}.\n\n`;
        whatsappMessage += `üìã *Mis datos de contacto:*\n`;
        whatsappMessage += `‚Ä¢ Nombre: ${formData.name}\n`;
        whatsappMessage += `‚Ä¢ Empresa: ${formData.company}\n`;
        whatsappMessage += `‚Ä¢ Tel√©fono: ${formData.phone}\n`;
        whatsappMessage += `‚Ä¢ Email: ${formData.email}\n\n`;
        
        if (formData.message) {
          whatsappMessage += `üí¨ *Mi consulta:*\n${formData.message}\n\n`;
        }
        
        whatsappMessage += `Me interesa conocer m√°s sobre los servicios log√≠sticos de ASL - Log√≠stica 3PL Colombia. ¬øPodr√≠an brindarme m√°s informaci√≥n?`;
        
        // Crear URL de WhatsApp
        const whatsappUrl = `https://wa.me/${phoneNumber.replace(/[^0-9]/g, '')}?text=${encodeURIComponent(whatsappMessage)}`;
        
        // Cambiar texto del bot√≥n
        submitText.textContent = 'Abriendo WhatsApp...';
        
        // Peque√±a pausa antes de abrir WhatsApp
        await new Promise(resolve => setTimeout(resolve, 500));
        
        // Abrir WhatsApp
        window.open(whatsappUrl, '_blank');
        
        // Mostrar √©xito
        submitText.textContent = '¬°Enviado!';
        submitBtn.classList.remove('loading');
        submitBtn.classList.add('bg-green-500', 'hover:bg-green-600');
        
        // Cerrar modal despu√©s de un momento
        setTimeout(() => {
          closeModal();
        }, 1000);
        
      } catch (error) {
        console.error('Error al procesar el formulario:', error);
        
        // Restaurar estado del bot√≥n
        submitBtn.classList.remove('loading');
        submitBtn.disabled = false;
        submitText.textContent = originalText;
        
        // Mostrar error
        alert('Hubo un error al procesar su solicitud. Por favor, int√©ntelo nuevamente.');
      }
    });
  });
</script>