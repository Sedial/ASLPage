---
interface Props {
  id: string;
  title?: string;
  size?: 'sm' | 'md' | 'lg' | 'xl';
  open?: boolean;
}

const { id, title, size = 'md', open = false } = Astro.props;

const sizeClasses = {
  sm: 'max-w-md',
  md: 'max-w-lg',
  lg: 'max-w-2xl',
  xl: 'max-w-4xl'
};
---

<div 
  id={id} 
  class={`fixed inset-0 z-50 flex items-center justify-center p-4 bg-black bg-opacity-50 transition-opacity ${open ? 'opacity-100' : 'opacity-0 pointer-events-none'}`}
>
  <div class={`bg-white rounded-lg shadow-xl w-full ${sizeClasses[size]} transform transition-transform ${open ? 'scale-100' : 'scale-95'}`}>
    <div class="flex items-center justify-between p-4 border-b border-gray-200">
      {title && <h3 class="text-xl font-medium text-gray-900">{title}</h3>}
      <button 
        type="button" 
        class="text-gray-400 hover:text-gray-500 focus:outline-none" 
        onclick={`document.getElementById('${id}').classList.add('opacity-0', 'pointer-events-none'); document.getElementById('${id}').querySelector('div').classList.add('scale-95'); document.getElementById('${id}').querySelector('div').classList.remove('scale-100');`}
      >
        <span class="sr-only">Cerrar</span>
        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>
    <div class="p-6">
      <slot />
    </div>
    <div class="flex justify-end p-4 border-t border-gray-200">
      <slot name="footer" />
    </div>
  </div>
</div>

<script define:vars={{ id }}>
  document.addEventListener('keydown', (event) => {
    if (event.key === 'Escape') {
      const modal = document.getElementById(id);
      if (modal && !modal.classList.contains('pointer-events-none')) {
        modal.classList.add('opacity-0', 'pointer-events-none');
        modal.querySelector('div').classList.add('scale-95');
        modal.querySelector('div').classList.remove('scale-100');
      }
    }
  });

  window.openModal = function(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
      modal.classList.remove('opacity-0', 'pointer-events-none');
      modal.querySelector('div').classList.remove('scale-95');
      modal.querySelector('div').classList.add('scale-100');
    }
  };

  window.closeModal = function(modalId) {
    const modal = document.getElementById(modalId);
    if (modal) {
      modal.classList.add('opacity-0', 'pointer-events-none');
      modal.querySelector('div').classList.add('scale-95');
      modal.querySelector('div').classList.remove('scale-100');
    }
  };
</script>
