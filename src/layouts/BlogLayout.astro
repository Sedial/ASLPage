---
import BaseLayout from './BaseLayout.astro';
import Header from '../components/sections/Header.astro';
import Footer from '../components/sections/Footer.astro';
import ScrollToTop from '../components/common/ScrollToTop.astro';
import Breadcrumb from '../components/navigation/Breadcrumb.astro';

interface Props {
  title: string;
  description?: string;
  image?: string;
  publishDate?: Date | string;
  updatedDate?: Date | string;
  author?: string;
  authorImage?: string;
  category?: string;
  canonical?: string;
  noindex?: boolean;
  nofollow?: boolean;
}

const { 
  title, 
  description, 
  image, 
  publishDate,
  updatedDate,
  author,
  authorImage,
  category,
  canonical,
  noindex,
  nofollow 
} = Astro.props;

const site = await import('../data/site.json');
const formattedPublishDate = publishDate ? new Date(publishDate).toLocaleDateString('es-ES', {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
}) : null;

const formattedUpdatedDate = updatedDate ? new Date(updatedDate).toLocaleDateString('es-ES', {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
}) : null;

const breadcrumbItems = [
  { label: 'Inicio', href: '/' },
  { label: 'Blog', href: '/blog' },
  { label: title, active: true }
];
---

<BaseLayout 
  title={title} 
  description={description} 
  image={image}
  canonical={canonical}
  noindex={noindex}
  nofollow={nofollow}
  ogType="article"
>
  <Header />
  
  <main class="max-w-4xl mx-auto px-4 py-8 sm:px-6 lg:px-8">
    <article class="mx-auto">
      <Breadcrumb items={breadcrumbItems} class="mb-6" />
      
      {image && (
        <img 
          src={image} 
          alt={title} 
          class="w-full h-64 sm:h-96 object-cover rounded-lg mb-6"
        />
      )}
      
      <h1 class="text-3xl md:text-4xl font-bold mb-4 text-gray-900">{title}</h1>
      
      <div class="flex flex-wrap items-center gap-4 mb-8 text-sm">
        {author && (
          <div class="flex items-center">
            {authorImage && (
              <img 
                src={authorImage} 
                alt={author} 
                class="w-10 h-10 rounded-full mr-2"
              />
            )}
            <span class="text-gray-700 font-medium">{author}</span>
          </div>
        )}
        
        {formattedPublishDate && (
          <div class="text-gray-600">
            <span>Publicado: {formattedPublishDate}</span>
            {formattedUpdatedDate && formattedPublishDate !== formattedUpdatedDate && (
              <span class="ml-2">(Actualizado: {formattedUpdatedDate})</span>
            )}
          </div>
        )}
        
        {category && (
          <span class="bg-primary-100 text-primary-800 text-xs font-medium px-3 py-1 rounded-full">
            {category}
          </span>
        )}
      </div>
      
      <div class="blog-content max-w-none">
        <slot />
      </div>
    </article>
  </main>
  
  <Footer />
  <ScrollToTop />
</BaseLayout>

<style>
  /* Additional blog-specific styles */
  .blog-content :global(h1:first-child) {
    margin-top: 0;
  }
  
  .blog-content :global(h2:first-child) {
    margin-top: 0;
  }
  
  .blog-content :global(p:last-child) {
    margin-bottom: 0;
  }
  
  .blog-content :global(ul li) {
    position: relative;
    padding-left: 0.5rem;
  }
  
  .blog-content :global(ol li) {
    position: relative;
    padding-left: 0.5rem;
  }
  
  .blog-content :global(table) {
    width: 100%;
    border-collapse: collapse;
    margin: 1.5rem 0;
  }
  
  .blog-content :global(th),
  .blog-content :global(td) {
    border: 1px solid #e5e7eb;
    padding: 0.75rem;
    text-align: left;
  }
  
  .blog-content :global(th) {
    background-color: #f9fafb;
    font-weight: 600;
  }
</style>
